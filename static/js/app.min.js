(function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c="function"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error("Cannot find module '"+i+"'");throw a.code="MODULE_NOT_FOUND",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u="function"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()({1:[function(require,module,exports){

$(document).ready(function() {

	console.log('starting output');

	var parser = require('./lib/parser.js');

});
},{"./lib/parser.js":3}],2:[function(require,module,exports){

var ajax = (function() {

    return {
        getRequest: function(ext, cb) {
            console.log(ext);
            axios.get(ext)
              .then(cb)
              .catch(function (error) {
                console.log(error);
              });
        },

        sendRequest: function(ext, t, cb) {
            var dt = JSON.stringify(t);
            axios.post(ext, dt)
              .then(cb)
              .catch(function (error) {
                console.log(error);
              });
        }

       };
})();
module.exports = ajax;

},{}],3:[function(require,module,exports){

var ajax = require('./ajax.js');
var viewer = require('./viewer.js');

var parser = (function() {
        var params;

        var makeRequest = function(u,t,m) {
             params = {
                "url": u,
                "type": t,
                "method": m
              };
            ajax.sendRequest('/poster', params, function (response) {
                var res = response.data;
                console.log('returned from /poster');

                if(params.type === 'xml') {
                    viewer.displayXML(res, params);
                }
                else {
                    viewer.displayHTML(res, params);
                }
            });
        };
        
        var makeListRequest = function() {
            var params = "?list=bigList";
            ajax.getRequest('/lister' + params, function (response) {
                var res = response.data;
                
               viewer.displayList(res.Items, editListItem.setButton, parseListItem.setButton);
            
            });
        };
        
        var addItemRequest = function(params) {
           
            ajax.sendRequest('/items', params, function (response) {
                var display = $('#display_tb');
                var res = response.data;
                console.dir(res.code);
                console.log(res.message)
                if(res.code == 500) {
                    display.html("message: " + res.message + "<br>code: " + res.code);
                }
                else {

                    display.text("Go says: status ok");
                }
            });
        };

         // Handler for Sidebar Parser Inputs
        var handleRadios = (function() {
            var type = '';
             var isSet = false;
            $('#resource-method').submit(function(e) {
                var url,type, method, tname = '';
                url = $('#inp_url').val();
                type = $('input[name=rsource_typ]:checked').val();
                e.preventDefault();
                e.stopImmediatePropagation();

                if(type === 'xml') {
                    tname = 'xml_typ';
                }
                else {
                    tname = 'http_typ';
                }
                method = $('input[name=' + tname + ']:checked').val();
                console.log('method: ' + method);

                if(url !== '' && type !== '' && method !== '') {
                    makeRequest(url, type, method);
                }
                else {
                    alert('Please select all fields.');
                    console.log('required fields empty!');
                }
            });
            $('input[name=rsource_typ]').on('click', function() {
                var id = '';
                type = $('input[name=rsource_typ]:checked').val();
                 if(type === 'xml') {
                    
                    $('#http-method-type').fadeOut('slow', function() {
                         $('#xml-method-type').fadeIn('slow');
                    });
                   
                }
                else {
                    
                    $('#xml-method-type').fadeOut('slow', function() {
                         $('#http-method-type').fadeIn('slow');
                    });
                    
                }
                
            });
          /*  $('input[name=xml_typ], input[name=http_typ]').on('click', function() {
                var formName = $('#resource-method');
                var quitListening = function() {
                    $('body').off('keypress');
                    $('#filter_btn').off('click');
                    isSet = false;
                };
                var setter = function(event) {
                    if(event.keyCode == 13 || event.which == 13) {
                        formName.submit();
                        quitListening();
                    }
                    else {
                        quitListening();
                    }
                };
                if(!isSet) {
                    $('body').on('keypress', function(event) {
                        event.preventDefault();
                        setter(event);  
                    });

                isSet = true;
                }
            });*/
            
       })();

       // Get the List of Content Providers
       var getList = (function() {
            $('#show-list').on('click', function() {
                makeListRequest();
            });
       })();


      // Handler for Editor Modal Inputs
       $('#new-item-form').submit(function(e) {
                var name, url, type, method, req = '';
                name = $('#i_name').val();
                url = $('#i_url').val();
                type = $('#i_type').val();
                method = $('#i_method').val();
                req = $('input[name=protor]:checked').val();
                var obj = {"req": req,
                        "name": name,
                        "url": url, 
                        "type": type, 
                        "method": method};
                e.preventDefault();
                e.stopImmediatePropagation();
                $('#save_display').off('click', viewer.setSave);
                console.log("name: " + name + "url: " + url + "type: " + type + " method: " + method + " req: " + req);
                // && url !== '' && type !== '' && method !== ''
                // , url, type, method
                if(req === 'add' && name !== '') {
                    $.modal.close();
                    if(url !== '') {
                        addItemRequest(obj);
                    }
                    else {
                        addItemRequest({"req": req,
                                        "name": name});
                    }
                }

                else if(req === 'del-cp' && name !== '') {
                    console.log(req + ' ' + name);
                    $.modal.close();
                    addItemRequest({"req": req,
                                    "name": name});
                }
                 else if(req === 'del-url' && url !== '') {
                    console.log(req + ' ' + url);
                    $.modal.close();
                    addItemRequest({"req": req,
                                    "url": url});
                }
                else if(req === 'modify' && name !== '' && url !== '') {
                    $.modal.close();
                    addItemRequest(obj);
                }
                else {
                    alert('Please select all necessary fields.');
                    console.log('required fields empty!');
                }
            });


       var editParserItem = (function() {
            $('.add-btn a[data-modal]').click(function(event) {
                var name, url, type, method, tname = '';
                name = $('#hidden_name').val();
                url = $('#inp_url').val();
                type = $('input[name=rsource_typ]:checked').val();
                if(type === 'xml') {
                    tname = 'xml_typ';
                }
                else {
                    tname = 'http_typ';
                }
                method = $('input[name=' + tname + ']:checked').val();
                console.log(typeof(name));
                if(name !== '') {
                    console.log("nomshky");
                    $('#i_name').val(name);
                }
                $('#i_url').val(url);
                $('#i_type').val(type);
                $('#i_method').val(method);

              $(this).modal();
              //document.getElementById('ex1').focus();
              return false;
            });
       })();


       var editListItem = (function() {
       		var setEditButton = function() {
       			var wasClicked = function(event) {
       				console.log("the box");
	                var name, url,type, method = '';
	                //console.log('item edit clicked');
	                var box = $(this).closest('.list_tables');
	                name = box.find('.listname').text();
                    var sub = $(this).closest('.url_wrapper_wrap');
	                url = sub.find('.listurl').text();
	                type = sub.find('.listtype').text();
	                method = sub.find('.listmethod').text();
	                console.log(url);

	                //console.log("stuff: " + name + ' ' + url + ' ' + type + ' ' + method);
	                $('#i_name').val(name);
	                $('#i_url').val(url);
	                $('#i_type').val(type);
	                $('#i_method').val(method);

	              $(this).modal();
	              return false;
	            };
	            //.off('click')
	            $('.ers a[data-modal]').off('click').on('click', wasClicked);
        };

        return {
        	setButton: function() {
        		setEditButton();
        	}

        };
       })();


       var parseListItem = (function() {
       		var setParseButton = function() {
       			var wasClicked = function(event) {
       				console.log("the box");
	                var name, url, type, method, ptype, pmethod = '';
	                //console.log('item edit clicked');
	                var box = $(this).closest('.list_tables');
                    var sub = $(this).closest('.url_wrapper_wrap');
	                name = box.find('.listname').text();
                    id = sub.find('.listid').text();
	                url = sub.find('.listurl').text();
	                type = sub.find('.listtype').text();
	                method = sub.find('.listmethod').text();
	                console.log("stuff: " + name + ' ' + url + ' ' + type + ' ' + method);
	                console.log("not box");
	                $('#hidden_id').val(id);
	                $('#hidden_name').val(name);
	                $('#inp_url').val(url);
	                if(type !== "" && type === "xml") {
	                	console.log('is xml');
	                	ptype = "xml_typ";
	                	if(method !== '' && method === "deep-xml") {
	                			
	                		pmethod = "deep_xml";
	                	} else if(method !== '' && method === "flat-xml") {
	                		pmethod = "flat_xml";
	                	} else {
	                		pmethod = "raw_xml";
	                	}
	                }
	                if(type !== "" && type === "http") {
	                	console.log('is http');
	                	ptype = "http_typ";
	                	if(method !== '' && method === "deep-http") {

	                		pmethod = "deep_http";
	                	} else if(method !== '' && method === "flat-http") {
	                		console.log('is flat http');
	                		pmethod = "flat_http";
	                	} else {
	                		pmethod = "raw_http";
	                	}
	                }
	                if(type === 'xml') {
		                    $('#http-method-type').fadeOut('slow', function() {
		                         $('#xml-method-type').fadeIn('slow');
		                    });
		                   
		                }
		                else {
		                    
		                    $('#xml-method-type').fadeOut('slow', function() {
		                         $('#http-method-type').fadeIn('slow');
		                    });
		                    
		                }
	                $('#' + ptype).prop("checked", true);
	                $('#' + pmethod).prop("checked", true);

	              //$(this).modal();
	              //return false;
	            };
	            
	            $('.prs a.item_parse').off('click').on('click', wasClicked);
        };

        return {
        	setButton: function() {
        		setParseButton();
        	}
        };
       })();
    
})();
module.exports = parser;

},{"./ajax.js":2,"./viewer.js":4}],4:[function(require,module,exports){
var ajax = require('./ajax.js');

var viewer = (function() {
    
    var getData = function() {
            var saveText = $('#save_text');
            return saveText.val();
        
        };
    var makeRequest = function(params) {
        ajax.sendRequest('/items', params, function (response) {
                    var disPlay = $('#display_tb');
                    var res = response.data;
                    console.dir(res.code);
                    console.log(res.message)
                    if(res.code == 500) {
                        disPlay.html("message: " + res.message + "<br>code: " + res.code);
                    }
                    else {

                        disPlay.text("Go says: status ok");
                    }
                });
    };

       return {
        
         setClear: function() {
                var el = $('#save_text');
                console.log('textarea cleared');
                el.val('');
             },
        setSave: function() {
                var stuff = getData();
                var url = $('#inp_url').val();
                var req = 'save-xml';
                console.log(stuff);
                var params = {"req": req,
                                "url": url,
                                "data": stuff};

                console.log('editing display');
                makeRequest(params);
             },
        setDelete: function() {
                var url = $('#inp_url').val();
                var req = 'del-xml-cache';
                console.log('deleting cache');
                var params = {"req": req,
                                "url": url};

                console.log('editing cache');
                makeRequest(params);
             },
        displayXML: function(result, params) {
            var display = $('#display_tb');
            var items = '';
            var check = 0;
            if(params.method === "flat-xml" || params.method === "deep-xml") {
                items += '<table id="fancytable" class="display"><col width="35%"><col width="65%">' +
                        '<thead><tr><th>Title</th><th>Keywords</th></tr></thead><tbody>';

                $.each(result, function(i,v) {
                        items += '<tr><td><a href="' + v.Location + '" target="_blank">' + v.Title + '</a></td><td>' + v.Keyword + '</td></tr>';
                });

                items += '</tbody></table>';

                
            }
            else if(params.method === "raw-xml") {
                
               items += '<textarea id="save_text" style="width: 100%; min-height: 500px;">' + result[0] + '</textarea>';
                check = 1;
            }
            display.html(items);

            $('#fancytable').DataTable({
                "searching": true
            });
            if(check === 1) {
                $('#save_display').on('click', viewer.setSave);
                $('#clear_display').on('click', viewer.setClear);
            }
            else {
                $('#save_display').off('click', viewer.setSave);
                $('#clear_display').off('click', viewer.setClear);
            }
            $('#delete_display').off('click').on('click', viewer.setDelete);
        },

        displayHTML: function(result) {

        },
        displayList: function(result, cb1, cb2) {
            var display = $('#display_tb');
            var items = '';
            $('#save_display').off('click', viewer.setSave);
            items += '<div class="list_wrapper">';
                
               $.each(result, function(i,v) {
                    var len = v.Urls.length;
                    var count = 0;
                     console.log(v.Urls.length);
                    items += '<div class="list_tables"><div class="row name_row"><div class="six columns listname">' + v.Name + '</div><div class="six columns"></div></div>';

                    $.each(v.Urls, function(i,m) {
                        var cls = '';
                        if(len > 1) {
                            if(count % 2 === 0) { 
                                cls = ' even';
                            } else { 
                                cls = ' odd';
                            }
                        }
                       items += '<div class="url_wrapper_wrap' + cls + '"><div class="row url_row"><div class="two columns listid">' + m.ID + '</div><div class="ten columns"><a href="' + m.Url + '" target="_blank" class="listurl">' + m.Url + '</a></div></div>' + '<div class="row meta_row"><div class="eight columns"><span class="listtype">' + m.Type + '</span><span class="listmethod">' + m.Method + '</span></div><div class="four columns"><span class="prs"><a href="javascript:void(0)" class="item_parse" name="item-parse" value="parse">Parse</a></span><span class="ers"><a href="#ex1" class="item_edit" data-modal>Edit</a></span></div></div></div>';

                        count++;

                    });
                   items += '</div>';
                });

                items += '</div>';
                display.html(items);
                cb1();
                cb2();
                $('#delete_display').off('click').on('click', viewer.setDelete);
        }

    };

})();
module.exports = viewer;

},{"./ajax.js":2}]},{},[1]);
